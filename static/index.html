<!DOCTYPE html>
<meta charset="utf-8">
<title>Thimble Published Page Viewer</title>
<style>
img {
  width: 320px;
}
</style>
<div id="thumbnails"></div>
<a href="" id="more" style="display: none">More&hellip;</a>
<script src="jquery.min.js"></script>
<script>
var PAGE_SIZE = 20;

function show(end) {
  var start = end - PAGE_SIZE;
  $("#more").attr("href", "?p=" + start).show();
  $.getJSON('/unique/' + start + '/' + PAGE_SIZE, function(data) {
    data.reverse();
    data.forEach(function(key) {
      var a = $('<a></a>')
        .attr('href', 'https://thimble.webmaker.org/p/' + key)
        .appendTo('#thumbnails');
      var img = $('<img>')
        .attr('src', '/images/' + key + '.png')
        .appendTo(a);
    });
  });
}

$(window).ready(function() {
  // http://stevenbenner.com/?p=634
  var queryString = {};
  window.location.href.replace(
    new RegExp("([^?=&]+)(=([^&]*))?", "g"),
    function($0, $1, $2, $3) { queryString[$1] = decodeURIComponent($3); }
  );
  var end = parseInt(queryString.p);
  if (!isNaN(end))
    show(end);
  else
    $.getJSON('/stats', function(stats) {
      show(stats.uniques);
    });
});
</script>
